---
import { getCollection } from 'astro:content';
import MainPage from '../../layouts/MainPage.astro';
import { PAGE_SIZE } from '../../consts';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  const totalPages = Math.ceil(posts.length / PAGE_SIZE);

  return Array.from({ length: totalPages }, (_, i) => ({
    params: { page: String(i + 1) },
  }));
}

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const currentPage = Number(Astro.params.page) || 1;
const start = (currentPage - 1) * PAGE_SIZE;
const end = start + PAGE_SIZE;

const paginatedPosts = posts.slice(start, end);
const totalPages = Math.ceil(posts.length / PAGE_SIZE);
---

<MainPage
  posts={paginatedPosts}
  currentPage={currentPage}
  totalPages={totalPages}
/>
